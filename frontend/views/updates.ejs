<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Bootstrap CSS & JS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
   <!-- css -->
    <link rel="stylesheet" href="/css/styles.css">
  

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <!-- Custom CSS for Updates Page -->
  <style>
    .update-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-bottom: 2rem;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
      position: relative;
    }

    .update-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .update-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 12px 32px rgba(0,0,0,0.12);
      border-color: rgba(102, 126, 234, 0.2);
    }

    .update-card:hover::before {
      opacity: 1;
    }

    .update-content {
      padding: 2rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .update-title {
      color: #1a202c;
      font-weight: 700;
      margin-bottom: 1rem;
      font-size: 1.25rem;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .update-description {
      color: #4a5568;
      line-height: 1.7;
      margin-bottom: 1.5rem;
      flex: 1;
      font-size: 0.95rem;
    }

    .update-meta {
      border-top: 1px solid #e2e8f0;
      padding-top: 1.25rem;
      margin-top: auto;
    }

    .update-date, .update-author {
      font-size: 0.875rem;
      font-weight: 500;
    }

    .update-date {
      color: #718096;
    }

    .update-author {
      color: #38a169;
    }

    .download-buttons {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .download-buttons .btn {
      transition: all 0.3s ease;
      border-radius: 8px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.8rem;
    }

    .download-buttons .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .download-buttons .btn-outline-primary:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      color: white;
    }

    .download-buttons .btn-outline-danger:hover {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-color: transparent;
      color: white;
    }



    .no-updates {
      text-align: center;
      padding: 3rem;
      color: #666;
    }

    .no-updates i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    #loadMoreBtn {
      border-radius: 25px;
      padding: 0.75rem 2rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,123,255,0.2);
    }

    #loadMoreBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,123,255,0.3);
    }

    #backToTop {
      border-radius: 50%;
      width: 50px;
      height: 50px;
      border: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    #backToTop:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .filter-btn {
      margin: 0.25rem;
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      transform: translateY(-1px);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      color: white;
    }

    @media (max-width: 768px) {
      .update-content {
        padding: 1.5rem;
      }

      .update-title {
        font-size: 1.1rem;
      }

      .update-description {
        font-size: 0.9rem;
      }

      .download-buttons {
        flex-direction: column;
        gap: 0.5rem;
        width: 50%;
      }

      .download-buttons .btn {
        width: 50%;
        justify-content: center;
      }

      .update-meta {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
      }

      .btn-group {
        flex-direction: column;
        width: 100%;
      }

      .filter-btn {
        margin: 0.125rem;
        width: 100%;
      }

      .stats-badge {
        font-size: 0.75rem;
        padding: 0.4rem 0.8rem;
      }

      .update-card {
        margin-bottom: 1.5rem;
      }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .update-card:nth-child(odd) {
      animation-delay: 0.1s;
    }

    .update-card:nth-child(even) {
      animation-delay: 0.2s;
    }
  </style>
</head>
<body>
  <%- include('partials/navbar') %>

  <section>

<% const activeUpdates = updates.filter(u => u.isActive).sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 20); %>

  <div class="container my-4">
        <div class="row">
          <div class="col-12">
        <h2 class="text-center text-primary mb-4">
          <i class="fa fa-bullhorn me-2"></i>Latest Updates
        </h2>
        <p class="text-center text-muted mb-5">Stay updated with the latest news, announcements, and important information</p>

        <!-- Search and Filter Bar -->
        <!-- <div class="row mb-4">
          <div class="col-md-8 mx-auto">
            <div class="input-group shadow-sm">
              <span class="input-group-text bg-white border-end-0">
                <i class="fa fa-search text-muted"></i>
              </span>
              <input type="text" id="updateSearch" class="form-control border-start-0 ps-0"
                     placeholder="Search updates..." aria-label="Search updates">
              <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                <i class="fa fa-times"></i>
              </button>
            </div>
          </div>
        </div> -->

        <!-- Filter Buttons -->
        <!-- <div class="row mb-4">
          <div class="col-12 text-center">
            <div class="btn-group flex-wrap" role="group" aria-label="Filter updates">
              <button type="button" class="btn btn-outline-primary active filter-btn" data-filter="all">
                <i class="fa fa-list me-1"></i>All Updates
              </button>
              <button type="button" class="btn btn-outline-success filter-btn" data-filter="with-image">
                <i class="fa fa-image me-1"></i>With Images
              </button>
              <button type="button" class="btn btn-outline-danger filter-btn" data-filter="with-pdf">
                <i class="fa fa-file-pdf me-1"></i>With PDFs
              </button>
              <button type="button" class="btn btn-outline-info filter-btn" data-filter="recent">
                <i class="fa fa-clock me-1"></i>Recent (Last 7 days)
              </button>
            </div>
          </div>
        </div> -->

        <!-- Statistics Badges -->
        <!-- <div class="row mb-4">
          <div class="col-12">
            <div class="d-flex justify-content-center flex-wrap gap-3">
              <div class="badge bg-primary p-3 rounded-pill">
                <i class="fa fa-list me-2"></i>
                <strong><%= updates.length %></strong> Total Updates
              </div>
              <div class="badge bg-success p-3 rounded-pill">
                <i class="fa fa-image me-2"></i>
                <strong><%= updates.filter(u => u.imageUrl).length %></strong> With Images
              </div>
              <div class="badge bg-danger p-3 rounded-pill">
                <i class="fa fa-file-pdf me-2"></i>
                <strong><%= updates.filter(u => u.pdfLink).length %></strong> With PDFs
              </div>
              <div class="badge bg-info p-3 rounded-pill">
                <i class="fa fa-clock me-2"></i>
                <strong><%= updates.filter(u => (new Date() - new Date(u.date)) / (1000 * 60 * 60 * 24) <= 7).length %></strong> Recent
              </div>
            </div>
          </div>
        </div> -->

        <!-- Results Counter -->
        <div class="row mb-4">
          <div class="col-12 text-center">
            <div id="resultsCounter" class="text-muted">
              Showing <strong id="visibleCount"><%= activeUpdates.length %></strong> of <strong><%= activeUpdates.length %></strong> updates
            </div>
          </div>
        </div>

    <!-- Updates List -->
    <div class="row" id="updatesContainer">
      <% activeUpdates.forEach((update, index) => { %>
        <div class="col-lg-6 col-md-12 mb-4 update-item" data-category="<%= update.imageUrl ? 'with-image' : '' %> <%= update.pdfLink ? 'with-pdf' : '' %> <%= (new Date() - new Date(update.date)) / (1000 * 60 * 60 * 24) <= 7 ? 'recent' : '' %>">
          <div class="card update-card fade-in">
            <div class="card-body update-content">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center justify-content-between w-100">
                  <h5 class="update-title mb-0"><%= update.title %></h5>
                  <div class="download-buttons">
                    <% if (update.imageUrl) { %>
                      <a href="<%= update.imageUrl %>" download class="btn btn-sm btn-outline-primary me-2 download-btn image-download-btn" title="Download Image" blank >
                        <i class="fa fa-image me-1"></i>Download
                      </a>
                    <% } %>
                    <% if (update.pdfLink) { %>
                      <a href="<%= update.pdfLink %>" download class="btn btn-sm btn-outline-danger download-btn pdf-download-btn" title="Download PDF" blank >
                        <i class="fa fa-file-pdf me-1"></i>Download 
                      </a>
                    <% } %>
                  </div>
                </div>
              </div>

              <p class="update-description"><%= update.description %></p>

              <div class="update-meta mt-auto">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="update-date">
                    <i class="fa fa-calendar-alt text-primary me-1"></i>
                    <%= new Date(update.date).toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric'
                    }) %>
                    <% if (update.time) { %>
                      <span class="text-muted ms-1">at <%= update.time %></span>
                    <% } %>
                  </div>
                  <% if (update.author) { %>
                    <div class="update-author">
                      <i class="fa fa-user text-success me-1"></i>
                      <%= update.author %>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>

    <% if (activeUpdates.length === 0) { %>
      <div class="no-updates">
        <i class="fa fa-inbox"></i>
        <h4>No Updates Available</h4>
        <p>Check back later for the latest updates and announcements.</p>
      </div>
    <% } %>

    <!-- Load More Button -->
    <% if (activeUpdates.length > 6) { %>
      <div class="row mt-4">
        <div class="col-12 text-center">
          <button id="loadMoreBtn" class="btn btn-primary btn-lg">
            <i class="fa fa-plus-circle me-2"></i>Load More Updates
          </button>
        </div>
      </div>
    <% } %>

    <!-- Back to Top Button -->
    <button id="backToTop" class="btn btn-secondary position-fixed" style="bottom: 20px; right: 20px; display: none; z-index: 1000;">
      <i class="fa fa-arrow-up"></i>
    </button>
       </div>

  </div>
 </div>
  </section>

   <%- include('partials/footer') %>
  <!-- Custom JavaScript for Enhanced Interactions -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const updateCards = document.querySelectorAll('.update-card');
      const searchInput = document.getElementById('updateSearch');
      const clearSearchBtn = document.getElementById('clearSearch');
      const filterButtons = document.querySelectorAll('.filter-btn');
      const resultsCounter = document.getElementById('resultsCounter');
      const visibleCount = document.getElementById('visibleCount');
      const loadMoreBtn = document.getElementById('loadMoreBtn');

      let currentFilter = 'all';
      let searchTerm = '';

      // Initialize counter on page load
      updateCounter();

      // Initialize filter to show all cards
      filterCards();
      function updateCounter() {
        const visibleCards = document.querySelectorAll('.update-card:not(.d-none)');
        const totalCards = document.querySelectorAll('.update-card').length;
        visibleCount.textContent = visibleCards.length;
        resultsCounter.querySelector('strong:last-child').textContent = totalCards;
      }

      // Function to filter cards
      function filterCards() {
        const hasActiveFilter = searchTerm || currentFilter !== 'all';
        let visibleCount = 0;

        updateCards.forEach((card, index) => {
          const title = card.querySelector('.update-title').textContent.toLowerCase();
          const description = card.querySelector('.update-description').textContent.toLowerCase();
          const hasImage = card.querySelector('.image-download-btn') !== null;
          const hasPdf = card.querySelector('.pdf-download-btn') !== null;
          const dateText = card.querySelector('.update-date').textContent.trim();
          // Extract date from format like "Dec 24, 2025 at 10:30 AM" or just "Dec 24, 2025"
          const dateMatch = dateText.match(/(\w+)\s+(\d+),\s+(\d+)/);
          let date;
          if (dateMatch) {
            const [, month, day, year] = dateMatch;
            date = new Date(`${month} ${day}, ${year}`);
            // Check if date is valid
            if (isNaN(date.getTime())) {
              date = new Date(); // fallback to current date
            }
          } else {
            date = new Date(); // fallback
          }
          const isRecent = (new Date() - date) / (1000 * 60 * 60 * 24) <= 7;

          let showCard = true;

          // Search filter
          if (searchTerm) {
            showCard = title.includes(searchTerm) || description.includes(searchTerm);
          }

          // Category filter
          if (showCard) {
            switch (currentFilter) {
              case 'with-image':
                showCard = hasImage;
                break;
              case 'with-pdf':
                showCard = hasPdf;
                break;
              case 'recent':
                showCard = isRecent;
                break;
              default:
                showCard = true;
            }
          }

          // If no active filter, apply load more pagination
          if (!hasActiveFilter && index >= 6) {
            showCard = false;
          }

          card.classList.toggle('d-none', !showCard);
          if (showCard) visibleCount++;
        });

        // Show/hide load more button based on filter state
        if (loadMoreBtn) {
          if (hasActiveFilter) {
            loadMoreBtn.style.display = 'none';
          } else {
            loadMoreBtn.style.display = visibleCount >= updateCards.length ? 'none' : 'block';
          }
        }

        // After filtering, update the counter
        updateCounter();
      }

      // Search functionality
      searchInput.addEventListener('input', function() {
        searchTerm = this.value.toLowerCase().trim();
        filterCards();
      });

      // Clear search
      clearSearchBtn.addEventListener('click', function() {
        searchInput.value = '';
        searchTerm = '';
        filterCards();
      });

      // Filter buttons
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          filterButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          currentFilter = this.dataset.filter;
          filterCards();
        });
      });



      // Add click tracking for download buttons
      const downloadButtons = document.querySelectorAll('.download-btn');
      downloadButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          // Add a subtle click effect
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = 'scale(1)';
          }, 150);

          // Track download (you can add analytics here if needed)
          const link = this.getAttribute('href');
          if (link) {
            // Open in new tab for PDFs, download for images
            if (this.classList.contains('pdf-download-btn')) {
              window.open(link, '_blank');
            } else {
              // For images, create a temporary link to trigger download
              const a = document.createElement('a');
              a.href = link;
              a.download = '';
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
            }
            e.preventDefault();
          }
        });
      });

      // Add scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      // Observe all update cards for scroll animations
      updateCards.forEach(card => {
        // Set initial animation state
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
      });

      // Add keyboard navigation for download buttons
      downloadButtons.forEach(button => {
        button.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
        button.setAttribute('tabindex', '0');
      });





      // Back to Top functionality
      const backToTopBtn = document.getElementById('backToTop');
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
          backToTopBtn.style.display = 'block';
        } else {
          backToTopBtn.style.display = 'none';
        }
      });

      backToTopBtn.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

  
   
</body>
</html>